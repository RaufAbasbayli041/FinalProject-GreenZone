# –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ç–æ–∫–µ–Ω–æ–º

## üîç **–ü—Ä–æ–±–ª–µ–º–∞ –Ω–∞–π–¥–µ–Ω–∞!**

–ò–∑ –ª–æ–≥–æ–≤ –≤–∏–¥–Ω–æ:
```
hasToken: false, tokenPreview: '–Ω–µ—Ç —Ç–æ–∫–µ–Ω–∞', localStorageKeys: Array(9)
AuthContext: –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: {user: {‚Ä¶}, isAuthenticated: true}
```

**–ü—Ä–∏—á–∏–Ω–∞**: –¢–æ–∫–µ–Ω –±—ã–ª **—É–¥–∞–ª–µ–Ω —Ñ—É–Ω–∫—Ü–∏–µ–π `isTokenValid()`** –∫–∞–∫ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π, –Ω–æ **—Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –æ—Å—Ç–∞–ª–æ—Å—å**.

## üõ†Ô∏è **–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**:

### 1. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**
–í `services/api.ts` —Ñ—É–Ω–∫—Ü–∏—è `getAuthToken()` —Ç–µ–ø–µ—Ä—å:
- ‚úÖ –£–¥–∞–ª—è–µ—Ç –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω
- ‚úÖ **–û—á–∏—â–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** 
- ‚úÖ **–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ –ª–æ–≥–∏–Ω** –ø—Ä–∏ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–º —Ç–æ–∫–µ–Ω–µ

### 2. **–£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
–î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö:
- `services/basket-api.ts`
- `contexts/auth-context.tsx` 
- `services/api.ts`

## üß™ **–î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã**:

### 1. **`localstorage-diagnostics.js`** - –ê–Ω–∞–ª–∏–∑ localStorage
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
localStorageDiagnostics.analyzeLocalStorage()  // –ê–Ω–∞–ª–∏–∑ localStorage
localStorageDiagnostics.checkAuthState()       // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
localStorageDiagnostics.simulateLogin()        // –°–∏–º—É–ª—è—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
```

### 2. **`token-restore.js`** - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
tokenRestore.restoreToken()           // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω
tokenRestore.forceReauth()            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
tokenRestore.testTokenAfterRestore() // –¢–µ—Å—Ç —Ç–æ–∫–µ–Ω–∞
```

## üöÄ **–ö–∞–∫ —Ä–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É**:

### **–í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ**
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
// 1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ token-restore.js
// 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ:
tokenRestore.restoreToken()
```

### **–í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
// 1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ token-restore.js  
// 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ:
tokenRestore.forceReauth()
// 3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞ –∏ –≤–æ–π–¥–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
```

### **–í–∞—Ä–∏–∞–Ω—Ç 3: –†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞**
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
localStorage.removeItem('auth_token')
localStorage.removeItem('authState')
// –ó–∞—Ç–µ–º –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞
```

## üîß **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ**:

### **–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `getAuthToken()`**:
```typescript
// –ë–´–õ–û (–ø—Ä–æ–±–ª–µ–º–∞):
if (token && !isTokenValid(token)) {
  localStorage.removeItem('auth_token')  // ‚ùå –¢–æ–ª—å–∫–æ —É–¥–∞–ª—è–ª–∏ —Ç–æ–∫–µ–Ω
  return null
}

// –°–¢–ê–õ–û (—Ä–µ—à–µ–Ω–∏–µ):
if (token && !isTokenValid(token)) {
  localStorage.removeItem('auth_token')
  
  // ‚úÖ –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  import('@/lib/storage').then(({ storage }) => {
    const currentAuthState = storage.getAuthState()
    if (currentAuthState.isAuthenticated) {
      storage.setAuthState({ user: null, isAuthenticated: false })
      window.location.href = '/login'  // ‚úÖ –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –ª–æ–≥–∏–Ω
    }
  })
  
  return null
}
```

## üìã **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—à–µ–Ω–∏—è**:

### **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å**:
1. ‚úÖ –¢–æ–∫–µ–Ω –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
2. ‚úÖ –ü—Ä–∏ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–º —Ç–æ–∫–µ–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ –ª–æ–≥–∏–Ω
3. ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å
4. ‚úÖ Basket API —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –≤–∞–ª–∏–¥–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º

### **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–∂–Ω–æ —Ç–∞–∫**:
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
console.log('–¢–æ–∫–µ–Ω:', localStorage.getItem('auth_token'))
console.log('–°–æ—Å—Ç–æ—è–Ω–∏–µ:', JSON.parse(localStorage.getItem('authState') || '{}'))
```

## üéØ **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:

### **–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
```
‚ùå isAuthenticated: true
‚ùå hasToken: false  
‚ùå API –∑–∞–ø—Ä–æ—Å—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
‚ùå –ö–æ—Ä–∑–∏–Ω–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
```

### **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
```
‚úÖ isAuthenticated: true
‚úÖ hasToken: true
‚úÖ API –∑–∞–ø—Ä–æ—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç
‚úÖ –ö–æ—Ä–∑–∏–Ω–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
```

## üö® **–í–∞–∂–Ω–æ**:

1. **–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ –ª–æ–≥–∏–∫–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏** - —Ç–æ–∫–µ–Ω —É–¥–∞–ª—è–ª—Å—è, –Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ –æ—á–∏—â–∞–ª–æ—Å—å
2. **–¢–µ–ø–µ—Ä—å –≤—Å–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ** - —Ç–æ–∫–µ–Ω –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –≤–º–µ—Å—Ç–µ
3. **–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** - –ø—Ä–∏ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–º —Ç–æ–∫–µ–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–¥–µ—Ç –Ω–∞ –ª–æ–≥–∏–Ω
4. **–£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Ç–µ–ø–µ—Ä—å –≤–∏–¥–Ω–æ –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã —Å —Ç–æ–∫–µ–Ω–æ–º

## üîÑ **–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**:

1. **–û—á–∏—Å—Ç–∏—Ç–µ localStorage**: `localStorage.clear()`
2. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ –ª–æ–≥–∏–Ω** —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω**: `localStorage.getItem('auth_token')`
4. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∫–æ—Ä–∑–∏–Ω—É** - –¥–æ–ª–∂–Ω–∞ –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è
5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network tab** - –∑–∞–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization: Bearer {token}`

–¢–µ–ø–µ—Ä—å –ø—Ä–æ–±–ª–µ–º–∞ —Å —Ç–æ–∫–µ–Ω–æ–º –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞! üéâ
